# Migration Guide: openapi-zod-client → openapi-zod-validation

This guide helps you migrate from `openapi-zod-client` to `openapi-zod-validation` (our maintained fork).

## Overview

`openapi-zod-validation` is a maintained fork of `openapi-zod-client` with significant improvements:

- ✅ **No Zodios dependency** - Removed dependency on `@zodios/core`
- ✅ **Multiple templates** - Choose the right output for your needs
- ✅ **openapi-fetch integration** - Modern, type-safe HTTP client
- ✅ **Better naming** - Removed "Zodios" from all public APIs
- ✅ **Improved type safety** - Stricter TypeScript, zero type assertions
- ✅ **Better documentation** - Comprehensive guides and examples

## Breaking Changes

### 1. Package Name

```bash
# Old
npm install openapi-zod-client

# New
npm install openapi-zod-validation
```

### 2. Function Names

| Old Name                              | New Name                      |
| ------------------------------------- | ----------------------------- |
| `getZodiosEndpointDefinitionList()`   | `getEndpointDefinitionList()` |
| (No other breaking function changes)  |                               |

### 3. File Names (if importing internals)

| Old File                               | New File                       |
| -------------------------------------- | ------------------------------ |
| `zodiosEndpoint.helpers.ts`            | `endpoint.helpers.ts`          |
| `zodiosEndpoint.operation.helpers.ts`  | `endpoint.operation.helpers.ts`|
| `zodiosEndpoint.path.helpers.ts`       | `endpoint.path.helpers.ts`     |
| `getZodiosEndpointDefinitionList.ts`   | `getEndpointDefinitionList.ts` |

### 4. Type Names (if using internals)

| Old Type               | New Type            |
| ---------------------- | ------------------- |
| `ZodiosContext`        | `EndpointContext`   |
| (Types from `@zodios/core` removed) |           |

### 5. Default Template Changed

**Old behavior:**
- Default template generated a full Zodios HTTP client
- Required `@zodios/core` as peer dependency

**New behavior:**
- Default template (`schemas-with-metadata`) generates schemas + endpoint metadata
- No HTTP client generated by default
- No external dependencies beyond `zod`

**Migration path:**

```bash
# If you want the new default (schemas + metadata, no client):
openapi-zod-validation ./openapi.yaml -o ./api-client.ts
# Or explicitly:
openapi-zod-validation ./openapi.yaml -o ./api-client.ts --template schemas-with-metadata

# If you want a full HTTP client (like the old default):
openapi-zod-validation ./openapi.yaml -o ./api-client.ts --template schemas-with-client
```

### 6. Template Options

| Old Template | New Equivalent | Notes |
| ------------ | -------------- | ----- |
| `default` (Zodios client) | `schemas-with-client` | Now uses openapi-fetch instead of Zodios |
| `schemas-only` | `schemas-only` | ✅ Unchanged |
| (none) | `schemas-with-metadata` | ⭐ NEW - Default template |

## Migration Examples

### Example 1: Using Default Template

**Old (openapi-zod-client):**
```bash
npx openapi-zod-client ./openapi.yaml -o ./api-client.ts
```

Generated a Zodios client with `@zodios/core` dependency.

**New (openapi-zod-validation):**
```bash
npx openapi-zod-validation ./openapi.yaml -o ./api-client.ts
```

Now generates schemas + metadata (no HTTP client). To get a client:

```bash
npx openapi-zod-validation ./openapi.yaml -o ./api-client.ts --template schemas-with-client
```

This uses `openapi-fetch` instead of Zodios.

### Example 2: Programmatic Usage

**Old:**
```typescript
import { generateZodClientFromOpenAPI, getZodiosEndpointDefinitionList } from 'openapi-zod-client';

const endpoints = await getZodiosEndpointDefinitionList(openApiDoc, options);
const output = await generateZodClientFromOpenAPI({
  openApiDoc,
  distPath: './api-client.ts',
});
```

**New:**
```typescript
import { generateZodClientFromOpenAPI, getEndpointDefinitionList } from 'openapi-zod-validation';

const endpoints = await getEndpointDefinitionList(openApiDoc, options);
const output = await generateZodClientFromOpenAPI({
  openApiDoc,
  distPath: './api-client.ts',
  // Optional: specify template
  template: 'schemas-with-metadata', // or 'schemas-with-client'
});
```

### Example 3: Using Generated Client

**Old (Zodios):**
```typescript
import { api } from './api-client';

// Zodios client
const users = await api.get('/users');
```

**New (openapi-fetch with validation):**
```typescript
import { createApiClient } from './api-client';

const api = createApiClient({
  baseUrl: 'https://api.example.com',
  validationMode: 'strict', // or 'loose' or 'none'
});

// Type-safe + runtime validated
const users = await api.getUsers();
```

### Example 4: Migration Checklist

- [ ] Update package name: `openapi-zod-client` → `openapi-zod-validation`
- [ ] Update function calls: `getZodiosEndpointDefinitionList` → `getEndpointDefinitionList`
- [ ] Choose template:
  - `schemas-with-metadata` (default) - Schemas + metadata, no client
  - `schemas-with-client` - Full client with openapi-fetch
  - `schemas-only` - Just Zod schemas
- [ ] If using `schemas-with-client`:
  - [ ] Add peer dependencies: `openapi-fetch`, `openapi-typescript`
  - [ ] Generate TypeScript types: `npx openapi-typescript ./openapi.yaml -o ./schema.d.ts`
  - [ ] Update client usage (see Example 3 above)
- [ ] Remove `@zodios/core` dependency (if present)
- [ ] Run tests to verify behavior

## Benefits of Migration

### 1. No Zodios Dependency

**Before:**
```json
{
  "dependencies": {
    "@zodios/core": "^10.0.0",
    "axios": "^1.0.0"
  }
}
```

**After (schemas-with-metadata):**
```json
{
  "dependencies": {
    "zod": "^3.0.0"
  }
}
```

**After (schemas-with-client):**
```json
{
  "dependencies": {
    "zod": "^3.0.0"
  },
  "peerDependencies": {
    "openapi-fetch": "^0.10.0",
    "openapi-typescript": "^7.0.0"
  }
}
```

### 2. Better Flexibility

- **Schemas-only**: Use with any HTTP client
- **Schemas-with-metadata**: Build your own client wrapper
- **Schemas-with-client**: Full client with openapi-fetch

### 3. Modern Stack

- Uses `openapi-fetch` (lighter, faster than axios)
- Uses `openapi-typescript` for compile-time types
- Zod for runtime validation
- No legacy dependencies

### 4. Improved Type Safety

- Zero type assertions in generated code (except `as const`)
- Stricter TypeScript configuration
- Better error messages

## Getting Help

- **Documentation**: See `docs/USAGE.md` for comprehensive guide
- **Examples**: See `docs/EXAMPLES.md` for usage patterns
- **API Reference**: See `docs/API-REFERENCE.md`
- **openapi-fetch Integration**: See `docs/OPENAPI-FETCH-INTEGRATION.md`

## Gradual Migration Strategy

If you have a large codebase, consider this gradual approach:

1. **Phase 1: Install both packages**
   ```bash
   npm install openapi-zod-validation
   # Keep openapi-zod-client for now
   ```

2. **Phase 2: Generate with new package**
   ```bash
   npx openapi-zod-validation ./openapi.yaml -o ./api-client-new.ts --template schemas-with-client
   ```

3. **Phase 3: Update imports gradually**
   ```typescript
   // Old
   import { api } from './api-client';
   
   // New
   import { createApiClient } from './api-client-new';
   const api = createApiClient({ baseUrl: '...' });
   ```

4. **Phase 4: Remove old package**
   ```bash
   npm uninstall openapi-zod-client
   rm ./api-client.ts
   mv ./api-client-new.ts ./api-client.ts
   ```

## Troubleshooting

### Issue: "Cannot find module '@zodios/core'"

**Solution**: Remove `@zodios/core` from dependencies and use `schemas-with-client` template instead.

### Issue: "Template not found: default"

**Solution**: The `default` template was removed. Use `schemas-with-client` for a full HTTP client.

### Issue: "Generated code has no HTTP methods"

**Solution**: You're using `schemas-with-metadata` (the new default). Use `--template schemas-with-client` if you want a full client.

### Issue: "Types from openapi-typescript not found"

**Solution**: Generate types separately:
```bash
npx openapi-typescript ./openapi.yaml -o ./schema.d.ts
```

And ensure the path in your generated client matches.

## Still Have Questions?

Open an issue on GitHub with the `migration` label.

