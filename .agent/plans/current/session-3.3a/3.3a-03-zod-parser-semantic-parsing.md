# Plan: 3.3a.03 ‚Äî Zod Parser: Remove TS-Source String Heuristics

**Status:** üî≤ Not Started  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-13  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Bring Zod TS-source parsing into ADR-026 compliance by removing brittle ‚Äúnode text‚Äù logic:

- no `.getText()` comparisons to determine semantics,
- no regex parsing of TypeScript source,
- use ts-morph semantic APIs (symbol resolution) for correctness under aliasing and formatting changes.

This is an architectural correctness change, not a style cleanup.

---

## Repo Truth

- `parseZodSource()` currently uses `initializer.getText()` and re-parses via `createZodProject()` (`lib/src/schema-processing/parsers/zod/zod-parser.ts`).
- Multiple parser modules depend on detection logic in `zod-parser.detection.ts` and AST helpers in `zod-ast.ts`.

---

## Work

1. Define a symbol-resolution strategy for:
   - `z` import aliasing (`import { z as myZ } from 'zod'`)
   - re-export patterns
   - schema identifier references (`NewPet.and(...)`)
2. Replace ‚Äúparse expression via `getText()` then re-parse‚Äù with AST-first parsing where possible.
3. Add unit-level tests around AST helpers to prove aliasing correctness.
4. Ensure parser behavior remains strict:
   - unsupported constructs produce structured errors,
   - no silent ‚Äúskip schema‚Äù paths.

---

## Acceptance Criteria

- ADR-026 lint rules can be enabled for Zod TS-source parsing modules without exceptions.
- Parsing is robust to:
  - whitespace changes,
  - alias imports,
  - identifier-based composition.
- Unsupported patterns fail fast with helpful context (file, line/column when available).

---

## References

- `lib/src/schema-processing/parsers/zod/zod-parser.ts`
- `lib/src/schema-processing/parsers/zod/zod-parser.detection.ts`
- `lib/src/schema-processing/parsers/zod/zod-ast.ts`
- `.agent/plans/roadmap.md` (Session 3.3b; Scenario 3 dependency)
