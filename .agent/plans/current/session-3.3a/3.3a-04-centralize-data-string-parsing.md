# Plan: 3.3a.04 â€” Centralize + Validate Data-String Parsing

**Status:** ğŸ”² Not Started  
**Priority:** Medium  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-13  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Centralize â€œdata-string parsingâ€ (OpenAPI/JSON Schema strings with defined grammars) into small, pure utilities with tests.

This is allowed under ADR-026 because these are not TypeScript-source parsing problems.

---

## Targets

- OpenAPI `$ref` parsing
- Media type parsing/validation (e.g. `application/json`)
- Path-template parsing if present

---

## Repo Truth

- `$ref` parsing utility already exists and is tested:
  - `lib/src/shared/ref-resolution.ts`
  - `lib/src/shared/ref-resolution.test.ts`
- There are still ad-hoc `$ref` parsing callsites under `lib/src/schema-processing/**`.

---

## Work

1. Replace ad-hoc `$ref` parsing with `parseComponentRef()` (or extend it if required).
2. Create a dedicated media-type utility with strict validation and tests.
3. Ensure invalid inputs fail fast with context; no â€œignore and continueâ€.

---

## Acceptance Criteria

- No duplicated `$ref` parsing logic remains in `lib/src/schema-processing/**`.
- Invalid refs and unsupported media types fail fast with helpful errors.
- Utilities are unit-tested and used everywhere relevant.

---

## References

- `lib/src/shared/ref-resolution.ts`
- `lib/src/schema-processing/parsers/openapi/`
- `lib/src/schema-processing/context/`
