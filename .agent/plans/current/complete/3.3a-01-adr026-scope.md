# Plan: 3.3a.01 — ADR-026 Scope Definition (AST vs Data Strings)

**Status:** ✅ Complete  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-13  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Define a repo-specific, enforceable scope for ADR-026 with ABSOLUTE STRICTNESS:

- No grey areas, no "partially enforced" tiers, no excluded modules
- TS-source heuristics banned in ALL `src/` — no exceptions
- Data-string parsing banned everywhere except explicitly designated centralized utilities
- Ad-hoc scattered parsing is a violation, not a "needs improvement"

---

## Deliverables (Complete)

- ✅ Canonical scope statement with strict enforcement principle written to ADR-026 § "Scope Definition (Session 3.3a.01 Audit)"
- ✅ Enforcement table (no grey areas) written to ADR-026
- ✅ Designated centralized utility list added to ADR-026
- ✅ Roadmap updated (`.agent/plans/roadmap.md`)
- ✅ Session-entry updated (`.agent/prompts/session-entry.prompt.md`)
- ✅ Start-right prompt updated with non-negotiable strictness principles (`.agent/prompts/start-right.prompt.md`)

## Audit Summary — 31 Total Violations

Comprehensive file-by-file classification of all string/getText uses across `schema-processing/`:

### Category A: TS-Source Heuristic Violations (22)

- 7 `getText()==='z'` identity checks — must use symbol resolution
- 4 naming-convention heuristics (`endsWith('Schema')`) — must use symbol table
- 8 getText-then-manipulate patterns — must use semantic APIs
- 3 duplicated quote-stripping functions — must use `getLiteralValue()`

### Category B: Centralization Violations (7)

Ad-hoc `$ref` parsing scattered across 7 files. ALL must delegate to `shared/ref-resolution.ts`:

1. `parsers/openapi/builder.circular.ts`
2. `parsers/openapi/builder.parameters.ts`
3. `parsers/openapi/builder.request-body.ts`
4. `parsers/openapi/builder.responses.ts`
5. `context/template-context.mcp.inline-json-schema.ts`
6. `conversion/json-schema/convert-schema.ts`
7. `writers/markdown/index.ts`

### Category C: IR Text-Heuristic Violations (2)

Endpoint-dependency code using text heuristics on IR data (`schemaName.startsWith('z.')`). Must be replaced with explicit IR properties.

---

## Acceptance Criteria (Met)

- ✅ ADR-026 scope is written down in one canonical place and linked from all entry points
- ✅ No grey areas: no "partially enforced", no "excluded" tiers
- ✅ Ad-hoc data-string parsing is declared a violation, not a suggestion
- ✅ Strictness requirements are explicit: hard errors, no fallbacks, no tolerance paths

## Responsibility Boundary

**Begins:** Start of Session 3.3a — no predecessor.
**This plan owns:** Defining the ADR-026 scope, classifying violations, and writing the canonical scope statement to all entry-point documents.
**This plan does NOT own:** Implementing ESLint enforcement (plan 02), remediating code violations (plans 03-04), or fixing strictness issues (plans 05-08).
**Successor:** [3.3a.02 — ESLint Enforcement Redesign](../current/session-3.3a/3.3a-02-eslint-enforcement-redesign.md)

---

## References

- `docs/architectural_decision_records/ADR-026-no-string-manipulation-for-parsing.md`
- `lib/src/schema-processing/parsers/zod/`
- `lib/src/schema-processing/parsers/openapi/`
- `lib/src/shared/ref-resolution.ts`
