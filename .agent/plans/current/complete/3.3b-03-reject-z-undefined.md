# Plan: 3.3b.03 — Reject `z.undefined()` (Strictness Blocker)

**Status:** ✅ Complete  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-19 (completed)  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3b)

---

## Goal

Eliminate semantic loss around `z.undefined()` by making it a hard parse error with actionable guidance.

---

## Final Verification Snapshot (2026-02-19)

```bash
# Targeted red/green scope
cd lib
pnpm vitest run src/schema-processing/parsers/zod/zod-parser.primitives.unit.test.ts \
  src/schema-processing/parsers/zod/zod-parser.integration.test.ts
pnpm vitest run --config vitest.transforms.config.ts \
  tests-transforms/__tests__/transform-samples.integration.test.ts
cd ..

# Full quality gates (one-by-one)
pnpm clean
pnpm install --frozen-lockfile
pnpm build
pnpm format:check
pnpm type-check
pnpm lint
pnpm test
pnpm character
pnpm test:snapshot
pnpm test:gen
pnpm test:transforms
```

| Gate / Check                                                             | Result  |
| ------------------------------------------------------------------------ | ------- |
| Primitive + parser integration strictness tests                          | ✅ pass |
| `transform-samples.integration.test.ts` strict `z.undefined()` assertion | ✅ pass |
| Full quality gate sequence (`clean` → `test:transforms`)                 | ✅ pass |

---

## Completion Summary

1. Parser primitive handling now rejects standalone `z.undefined()` with explicit actionable guidance instead of returning an IR schema with `type: undefined`.
2. Integration coverage verifies declaration-level failures include `PARSE_ERROR`, schema name context, and source location.
3. Transform-sample strictness coverage now proves unsupported `z.undefined()` input fails visibly (no tolerated degradation path).
4. Happy-path primitive fixture baseline was tightened by removing `z.undefined()` from parse-success fixtures and expected outputs.

---

## Acceptance Criteria

- `z.undefined()` is rejected as a hard parse error with location and remediation guidance: ✅
- No plan-owned path silently degrades `z.undefined()` to permissive schema output: ✅
- Transform-sample strict tests fail fast if `z.undefined()` appears in parseable source: ✅

---

## References

- `lib/src/schema-processing/parsers/zod/zod-parser.primitives.ts`
- `lib/src/schema-processing/parsers/zod/zod-parser.primitives.unit.test.ts`
- `lib/src/schema-processing/parsers/zod/zod-parser.integration.test.ts`
- `lib/tests-transforms/__tests__/transform-samples.integration.test.ts`
- `lib/tests-fixtures/zod-parser/happy-path/primitives.zod4.ts`
- `lib/tests-fixtures/zod-parser/happy-path/primitives.expected.json`

---

## Successor

Next plan: [3.3b.04 — Format Parity](../session-3.3b/3.3b-04-format-parity-hostname-float.md)
