# Plan: 3.3a.06 — Remove Swallowed Errors (Fail Fast With Context)

**Status:** ✅ Complete  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-17 (completed)  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Eliminate "ignore and continue" behavior (`catch {}` / silent skips) from strict pipeline code paths.

Malformed or unsupported input must fail fast with contextual, actionable errors.

---

## Final Verification Snapshot (2026-02-17)

```bash
pnpm qg
```

| Gate / Check             | Result  |
| ------------------------ | ------- |
| `pnpm build`             | ✅ pass |
| `pnpm format:check`      | ✅ pass |
| `pnpm type-check`        | ✅ pass |
| `pnpm lint`              | ✅ pass |
| `pnpm test`              | ✅ pass |
| `pnpm character`         | ✅ pass |
| `pnpm test:snapshot`     | ✅ pass |
| `pnpm test:gen`          | ✅ pass |
| `pnpm test:transforms`   | ✅ pass |
| Full `pnpm qg` aggregate | ✅ pass |

---

## Completion Summary

1. Replaced swallowed dependency-ref errors in `lib/src/schema-processing/context/template-context.endpoints.dependencies.ts` with fail-fast ref validation that includes endpoint/source context and explicit invalid-vs-unsupported failure classes.
2. Replaced silent declaration skipping in `lib/src/schema-processing/parsers/zod/zod-parser.ts` with explicit `PARSE_ERROR` entries for unsupported declarations and parser exceptions, including declaration name and source location.
3. Hardened circular-reference extraction in `lib/src/schema-processing/parsers/openapi/builder.circular.ts` so malformed or non-schema refs throw immediately instead of being suppressed.
4. Tightened centralized component-ref validation in `lib/src/schema-processing/parsers/openapi/builder.component-ref-resolution.ts` so only officially supported component ref prefixes are accepted.
5. Added and updated unit/integration tests to assert strict fail-fast behavior and actionable message quality in all remediated hotspots.
6. Extended valid Zod 4 parser coverage for `z.bigint()` and `z.uuidv7()` to avoid false strictness failures for officially supported constructs.

---

## Non-Ephemeral Architecture Notes

- Strict ref parsing now consistently differentiates:
  - invalid ref syntax/prefix,
  - unsupported component category,
  - unresolved target lookup.
- OpenAPI component-ref behavior continues to centralize in `builder.component-ref-resolution.ts`; downstream builders should delegate to this utility rather than adding local parsing/catch logic.
- Zod declaration parsing no longer has a silent skip path; unsupported declarations are now explicit parse failures with source context.

---

## Acceptance Criteria

- No swallowed errors remain in strict pipeline code paths owned by this plan: ✅
- No silent declaration-skip path remains in `parseSchemaDeclarations`: ✅
- Invalid refs in owned hotspots fail fast with contextual errors: ✅
- Tests cover strict failure behavior in each remediated hotspot: ✅

---

## Successor

Next plan: [3.3a.07 — Remove Escape Hatches](../session-3.3a/3.3a-07-remove-escape-hatches.md)
