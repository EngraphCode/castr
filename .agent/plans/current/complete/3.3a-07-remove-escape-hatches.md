# Plan: 3.3a.07 — Remove Escape Hatches (Type Assertions, any, eslint-disable)

**Status:** ✅ Complete  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-17 (completed)  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Bring product code into strict alignment with `.agent/directives/RULES.md`:

- no `as` (except `as const`),
- no `any`,
- no non-null assertions (`!`),
- no `eslint-disable` to bypass correctness.

If a boundary is untyped, add runtime validation and infer types from it.

---

## Final Verification Snapshot (2026-02-17)

```bash
pnpm format:check
pnpm build
pnpm type-check
pnpm lint
pnpm test
pnpm test:snapshot
pnpm test:gen
pnpm character
pnpm test:transforms
```

| Gate / Check           | Result  |
| ---------------------- | ------- |
| `pnpm format:check`    | ✅ pass |
| `pnpm build`           | ✅ pass |
| `pnpm type-check`      | ✅ pass |
| `pnpm lint`            | ✅ pass |
| `pnpm test`            | ✅ pass |
| `pnpm test:snapshot`   | ✅ pass |
| `pnpm test:gen`        | ✅ pass |
| `pnpm character`       | ✅ pass |
| `pnpm test:transforms` | ✅ pass |

---

## Completion Summary

1. Removed all non-approved `eslint-disable` directives from code and docs; kept only explicitly `JC`-annotated allowances.
2. Replaced console/shell escape-hatch patterns with rule-compliant implementations (`process.stdout.write`, `fs/promises` operations).
3. Eliminated assertion-based typing in OpenAPI parsing and strengthened boundary checks with typed guards.
4. Refactored Zod parser hotspots to remove suppression-driven typing escapes while preserving strict fail-fast behavior.
5. Updated deterministic/strictness-adjacent tests and snapshots where needed so behavior remains validated under strict lint rules.
6. Confirmed lint/type/test quality gates remain green after escape-hatch removal.

---

## Non-Ephemeral Architecture Notes

- Policy enforcement for check-disabling directives is explicit: only `JC`-annotated allowances are permitted.
- Type-safety remediation should favor boundary validation and typed construction over assertions/suppressions.
- Any future strictness exception must be documented in governing directives first, then implemented.

---

## Acceptance Criteria

- Escape hatches are eliminated from product code in this plan scope: ✅
- Lint enforces the rule without new blanket exceptions: ✅
- Boundary-validation refactors are covered by passing tests: ✅

---

## Successor

Next plan: [3.3a.08 — Prove Determinism](../session-3.3a/3.3a-08-prove-determinism.md)
