# Plan: 3.3a.02 â€” ESLint ADR-026 Enforcement Redesign

**Status:** ðŸ”² Not Started  
**Priority:** High  
**Created:** 2026-02-13  
**Last Updated:** 2026-02-13  
**Parent:** [roadmap.md](../../roadmap.md) (Session 3.3a)

---

## Goal

Enable ADR-026 strict enforcement with ABSOLUTE strictness â€” no grey areas, no loopholes:

- TS-source heuristics (`getText()`, regex, text comparison) banned in ALL `src/` files.
- Data-string methods (`startsWith`, `includes`, `split`, `slice`) banned in ALL `src/` files EXCEPT in designated centralized utility modules (currently only `src/shared/ref-resolution.ts`).
- Enforcement cannot be bypassed by moving files between directories.
- No `eslint-disable` workarounds permitted.

---

## Before You Start

1. **Read** [ADR-026 Â§ "Scope Definition"](../../../docs/architectural_decision_records/ADR-026-no-string-manipulation-for-parsing.md) â€” this contains the canonical enforcement table, designated utility list, and `getText()` principle that the ESLint config must match.
2. **Read** [RULES.md](../../directives/RULES.md) â€” engineering standards this work must uphold.
3. **Verify baseline:** `pnpm type-check && pnpm test` â€” must pass before starting.

---

## Responsibility Boundary

**Begins after:** [3.3a.01 â€” ADR-026 Scope Definition](../../current/complete/3.3a-01-adr026-scope.md) (complete)
**This plan owns:** Redesigning `lib/eslint.config.ts` so the lint rules match the strict scope defined in ADR-026 Â§ "Scope Definition". Configuring selectors, file globs, and exemptions.
**This plan does NOT own:** Remediating the violations that lint now catches (that's plans 03 and 04). **Do NOT fix violations in this plan** â€” only configure enforcement. Lint WILL fail after this plan; that is expected and correct.
**Successor:** [3.3a.03 â€” Zod Parser Semantic Parsing](../../current/session-3.3a/3.3a-03-zod-parser-semantic-parsing.md)

---

## Repo Truth

- ESLint config is `lib/eslint.config.ts` (no repo-root `eslint.config.ts`).
- Current schema-processing override disables `no-restricted-syntax` (`lib/eslint.config.ts:249`), which also disables earlier regex selectors for those files.
- ADR-026 Â§ "Scope Definition" defines the strict enforcement principle and designated utility list.

---

## Work

1. Remove the schema-processing override that turns `no-restricted-syntax` off.
2. Implement the strict enforcement scope from ADR-026:
   - Ban `getText()` identity comparison, regex, and text comparison in ALL `src/**/*.ts`.
   - Ban data-string methods in ALL `src/**/*.ts` except designated centralized utilities.
   - Exempt test files (`**/*.test.ts`, `**/*.spec.ts`, `tests-*/**`).
3. Narrow selectors to avoid false positives on:
   - discriminated-union checks (`kind === 'schema'`),
   - `typeof` type narrowing,
   - array `.includes()` (not string operations).
4. Turn ADR-026 rules on as `error` â€” no warnings, no off.
5. Prove the enforcement cannot be bypassed by moving code into another folder.
6. **Do NOT remediate violations.** This plan configures lint. Plans 03 and 04 fix the code.

---

## Acceptance Criteria

- `pnpm lint` flags TS-source heuristic violations (Category A: `getText()` identity, regex, text comparison) and ad-hoc data-string violations (Category B: inline `startsWith`, `split` etc. outside designated utilities).
- Target: all 31 violations from the 3.3a.01 audit are caught. If any cannot be expressed as ESLint `no-restricted-syntax` selectors (e.g., Category C IR text-heuristics that are valid string operations on non-TS data), document them as "requires manual review" and add a tracking comment in the ESLint config.
- `pnpm lint` does NOT flag discriminated-union checks, type narrowing, or designated centralized utilities.
- No `eslint-disable` comments are required.
- Enforcement principle: if a file can dodge lint by moving directories, the configuration is wrong.

---

## References

- `lib/eslint.config.ts`
- `docs/architectural_decision_records/ADR-026-no-string-manipulation-for-parsing.md` Â§ "Scope Definition"
- `.agent/directives/RULES.md`
